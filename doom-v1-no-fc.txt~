;; This buffer is for notes you don't want to save, and for Lisp evaluation.
;; If you want to create a file, visit that file with C-x C-f,
;; then enter the text in that file's own buffer.

for _ in range(200):
    for _ in range(2):
        sares = list(play_episodes(env, EpsilonGreedyQAgent(acting_model, epsilon=.05), episode_count=10))
        print('average reward/episode = {}'.format(
            sum(r for _, _, r, _ in sares) / float(sum(e for _, _, _, e in sares))))
        prev_frames, target_action_rewards = sares_to_input_targets(target_model, sares, reward_clip=5, n_misses=200)
        acting_model.fit(x=prev_frames, y=target_action_rewards, batch_size=BATCH_SIZE, nb_epoch=1, verbose=0)
target_model = copy_model(acting_model)

    model = Sequential()
    model.add(Convolution2D(
        2, nb_row=6, nb_col=6, border_mode='valid', weights=conv1_weights,
        input_shape=[HEIGHT, WIDTH, 3], dim_ordering='tf'))
    model.add(Activation('relu'))
    model.add(Convolution2D(4, nb_row=2, nb_col=2, weights=conv2_weights))
    model.add(Activation('relu'))
    model.add(Flatten())
    #model.add(Dense(128, init='normal', activation='linear', weights=dense1_weights))
    #model.add(Activation('relu'))
    model.add(Dense(4, init='normal', activation='linear', weights=dense2_weights))
    model.compile(loss='mse', optimizer='adam')
 

average reward/episode = -321.4
Training on 1/201 success/total out of 658 1-step experiences with actions distribution [ 25   2   1 173]
average reward/episode = -354.0
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [145   3  10  42]
average reward/episode = -225.0
Training on 5/205 success/total out of 548 1-step experiences with actions distribution [179   6  12   8]
average reward/episode = -355.0
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [192   3   2   3]
average reward/episode = -334.4
Training on 1/201 success/total out of 685 1-step experiences with actions distribution [196   1   2   2]
average reward/episode = -109.4
Training on 8/205 success/total out of 316 1-step experiences with actions distribution [130  24   7  44]
average reward/episode = -333.4
Training on 2/201 success/total out of 677 1-step experiences with actions distribution [150   5   8  38]
average reward/episode = -353.0
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [193   1   4   2]
average reward/episode = -312.9
Training on 1/201 success/total out of 640 1-step experiences with actions distribution [196   2   1   2]
average reward/episode = -353.0
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [193   1   3   3]
average reward/episode = -278.3
Training on 1/201 success/total out of 590 1-step experiences with actions distribution [195   3   2   1]
average reward/episode = -324.4
Training on 1/201 success/total out of 665 1-step experiences with actions distribution [190   1   5   5]
average reward/episode = -328.8
Training on 3/202 success/total out of 690 1-step experiences with actions distribution [192   5   3   2]
average reward/episode = -354.5
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  2   3   2 193]
average reward/episode = -355.0
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  3   1   3 193]
average reward/episode = -354.5
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  1   4   2 193]
average reward/episode = -258.5
Training on 9/204 success/total out of 441 1-step experiences with actions distribution [  1 199   0   4]
average reward/episode = -283.3
Training on 1/201 success/total out of 600 1-step experiences with actions distribution [193   3   2   3]
average reward/episode = -353.5
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [194   1   3   2]
average reward/episode = -400.7
Training on 2/202 success/total out of 623 1-step experiences with actions distribution [  3 195   2   2]
average reward/episode = -103.8
Training on 14/207 success/total out of 259 1-step experiences with actions distribution [  1 206]
average reward/episode = -223.8
Training on 5/204 success/total out of 409 1-step experiences with actions distribution [  7 190   5   2]
average reward/episode = -353.0
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  3   1   1 195]
average reward/episode = -355.0
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  3   2   5 190]
average reward/episode = -290.3
Training on 2/202 success/total out of 615 1-step experiences with actions distribution [193   3   3   3]
average reward/episode = -352.5
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [190   3   3   4]
average reward/episode = -278.8
Training on 5/204 success/total out of 489 1-step experiences with actions distribution [  2 196   4   2]
average reward/episode = -373.1
Training on 5/203 success/total out of 597 1-step experiences with actions distribution [  2 192   8   1]
average reward/episode = -326.0
Training on 4/203 success/total out of 527 1-step experiences with actions distribution [  5 196   0   2]
average reward/episode = -354.5
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  3   3   1 193]
average reward/episode = -269.8
Training on 3/202 success/total out of 573 1-step experiences with actions distribution [197   3   1   1]
average reward/episode = -327.9
Training on 0/200 success/total out of 668 1-step experiences with actions distribution [192   3   4   1]
average reward/episode = -353.0
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  2   2   6 190]
average reward/episode = -235.1
Training on 7/204 success/total out of 423 1-step experiences with actions distribution [  3 198   1   2]
average reward/episode = -164.7
Training on 7/205 success/total out of 333 1-step experiences with actions distribution [  1 201   1   2]
average reward/episode = -353.5
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  1   1   1 197]
average reward/episode = -225.6
Training on 5/204 success/total out of 526 1-step experiences with actions distribution [194   7   1   2]
average reward/episode = -328.9
Training on 2/201 success/total out of 671 1-step experiences with actions distribution [184   5   3   9]
average reward/episode = -293.6
Training on 5/203 success/total out of 496 1-step experiences with actions distribution [  4 194   1   4]
average reward/episode = -239.9
Training on 9/205 success/total out of 429 1-step experiences with actions distribution [  5 193   5   2]
average reward/episode = -356.5
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  0   1 195   4]
average reward/episode = -307.9
Training on 1/201 success/total out of 631 1-step experiences with actions distribution [  4   3   0 194]
average reward/episode = -309.9
Training on 1/201 success/total out of 630 1-step experiences with actions distribution [  6   6   4 185]
average reward/episode = -353.5
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  7   2 191]
average reward/episode = -331.9
Training on 0/200 success/total out of 678 1-step experiences with actions distribution [195   0   2   3]
average reward/episode = -360.3
Training on 2/202 success/total out of 565 1-step experiences with actions distribution [  2 185   7   8]
average reward/episode = -316.7
Training on 2/202 success/total out of 513 1-step experiences with actions distribution [  0 194   5   3]
average reward/episode = -354.0
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [195   3   0   2]
average reward/episode = -354.0
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  1   5 190   4]
average reward/episode = -312.4
Training on 1/201 success/total out of 634 1-step experiences with actions distribution [  3   4 190   4]
average reward/episode = -320.9
Training on 1/201 success/total out of 654 1-step experiences with actions distribution [  1   3   2 195]
average reward/episode = -162.8
Training on 11/205 success/total out of 332 1-step experiences with actions distribution [  4 195   2   4]
average reward/episode = -278.9
Training on 9/204 success/total out of 472 1-step experiences with actions distribution [  0 202   1   1]
average reward/episode = -320.9
Training on 3/201 success/total out of 656 1-step experiences with actions distribution [189   5   4   3]
average reward/episode = -311.4
Training on 2/201 success/total out of 639 1-step experiences with actions distribution [194   3   2   2]
average reward/episode = -352.0
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  1   3   3 193]
average reward/episode = -353.0
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  4   2 192   2]
average reward/episode = -325.4
Training on 5/204 success/total out of 544 1-step experiences with actions distribution [  6 193   3   2]
average reward/episode = -310.9
Training on 1/201 success/total out of 636 1-step experiences with actions distribution [  4   2   2 193]
average reward/episode = -356.5
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  4   5 190   1]
average reward/episode = -164.2
Training on 8/206 success/total out of 334 1-step experiences with actions distribution [  5 196   4   1]
average reward/episode = -332.9
Training on 1/201 success/total out of 679 1-step experiences with actions distribution [192   3   5   1]
average reward/episode = -352.0
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [195   0   3   2]
average reward/episode = -346.9
Training on 4/204 success/total out of 575 1-step experiences with actions distribution [  2 197   3   2]
average reward/episode = -332.9
Training on 1/201 success/total out of 677 1-step experiences with actions distribution [  0   4   8 189]
average reward/episode = -354.5
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  3   3 190   4]
average reward/episode = -354.0
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  3   5 190   2]
average reward/episode = -375.5
Training on 2/202 success/total out of 584 1-step experiences with actions distribution [  1 201]
average reward/episode = -354.5
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  7   4   1 188]
average reward/episode = -353.0
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  1   0   1 198]
average reward/episode = -299.3
Training on 3/202 success/total out of 632 1-step experiences with actions distribution [193   3   3   3]
average reward/episode = -273.2
Training on 7/204 success/total out of 464 1-step experiences with actions distribution [  2 198   1   3]
average reward/episode = -354.5
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  3   3 191   3]
average reward/episode = -290.3
Training on 8/204 success/total out of 489 1-step experiences with actions distribution [  0 196   2   6]
average reward/episode = -337.4
Training on 2/201 success/total out of 685 1-step experiences with actions distribution [189   5   3   4]
average reward/episode = -355.0
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [196   0   0   4]
average reward/episode = -311.4
Training on 1/201 success/total out of 635 1-step experiences with actions distribution [  0   1 199   1]
average reward/episode = -427.9
Training on 1/201 success/total out of 645 1-step experiences with actions distribution [  2 195   3   1]
average reward/episode = -315.9
Training on 1/201 success/total out of 645 1-step experiences with actions distribution [  1   4   0 196]
average reward/episode = -354.0
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  3   4   1 192]
average reward/episode = -266.3
Training on 3/202 success/total out of 563 1-step experiences with actions distribution [  3   6 191   2]
average reward/episode = -158.0
Training on 11/207 success/total out of 339 1-step experiences with actions distribution [  3 200   2   2]
average reward/episode = -246.5
Training on 5/204 success/total out of 440 1-step experiences with actions distribution [  5 185   3  11]
average reward/episode = -310.9
Training on 2/201 success/total out of 631 1-step experiences with actions distribution [191   6   2   2]
average reward/episode = -307.9
Training on 1/201 success/total out of 630 1-step experiences with actions distribution [192   3   2   4]
average reward/episode = -353.5
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  5   1 193   1]
average reward/episode = -353.0
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  4   2 194]
average reward/episode = -354.0
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  0   6   0 194]
average reward/episode = -168.5
Training on 7/205 success/total out of 339 1-step experiences with actions distribution [  1 200   2   2]
average reward/episode = -359.3
Training on 2/202 success/total out of 561 1-step experiences with actions distribution [  2 195   2   3]
average reward/episode = -355.5
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  4   7   2 187]
average reward/episode = -297.8
Training on 3/202 success/total out of 626 1-step experiences with actions distribution [195   4   1   2]
average reward/episode = -354.0
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  1   0 199]
average reward/episode = -351.5
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  2   2 195   1]
average reward/episode = -314.4
Training on 2/201 success/total out of 640 1-step experiences with actions distribution [189   6   1   5]
average reward/episode = -454.0
Training on 2/201 success/total out of 684 1-step experiences with actions distribution [  3 198]
average reward/episode = -355.0
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  1   0   4 195]
average reward/episode = -353.0
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  8   2   2 188]
average reward/episode = -180.8
Training on 7/205 success/total out of 359 1-step experiences with actions distribution [  3 201   0   1]
average reward/episode = -353.0
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [195   1   0   4]
average reward/episode = -355.5
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  2   1 193   4]
average reward/episode = -332.2
Training on 4/203 success/total out of 535 1-step experiences with actions distribution [  0 201   0   2]
average reward/episode = -354.5
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [194   0   2   4]
average reward/episode = -308.4
Training on 1/201 success/total out of 631 1-step experiences with actions distribution [  4   3 191   3]
average reward/episode = -357.5
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  1   6   3 190]
average reward/episode = -204.9
Training on 9/206 success/total out of 395 1-step experiences with actions distribution [  2 199   3   2]
average reward/episode = -275.5
Training on 5/203 success/total out of 469 1-step experiences with actions distribution [  7 190   2   4]
average reward/episode = -281.8
Training on 2/202 success/total out of 592 1-step experiences with actions distribution [194   7   1]
average reward/episode = -310.4
Training on 1/201 success/total out of 634 1-step experiences with actions distribution [  2   3 195   1]
average reward/episode = -355.5
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  1   4   4 191]
average reward/episode = -354.5
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  1   4   2 193]
average reward/episode = -302.8
Training on 3/202 success/total out of 643 1-step experiences with actions distribution [188   3   5   6]
average reward/episode = -352.5
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  2   1 192   5]
average reward/episode = -339.8
Training on 5/203 success/total out of 548 1-step experiences with actions distribution [  3 192   6   2]
average reward/episode = -403.5
Training on 2/202 success/total out of 627 1-step experiences with actions distribution [  5 194   2   1]
average reward/episode = -354.5
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [195   2   1   2]
average reward/episode = -353.0
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  6   2 188   4]
average reward/episode = -338.9
Training on 1/201 success/total out of 688 1-step experiences with actions distribution [  3   2 194   2]
average reward/episode = -317.9
Training on 0/200 success/total out of 645 1-step experiences with actions distribution [  4   5   8 183]
average reward/episode = -318.9
Training on 2/202 success/total out of 517 1-step experiences with actions distribution [  4 197   1]
average reward/episode = -327.9
Training on 1/201 success/total out of 666 1-step experiences with actions distribution [195   2   3   1]
average reward/episode = -315.9
Training on 1/201 success/total out of 641 1-step experiences with actions distribution [  6   4   2 189]
average reward/episode = -272.2
Training on 6/204 success/total out of 480 1-step experiences with actions distribution [  1 200   1   2]
average reward/episode = -247.4
Training on 7/205 success/total out of 443 1-step experiences with actions distribution [  7 192   4   2]
average reward/episode = -339.4
Training on 1/201 success/total out of 695 1-step experiences with actions distribution [  6   1 190   4]
average reward/episode = -351.0
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [194   1   2   3]
average reward/episode = -330.4
Training on 1/201 success/total out of 672 1-step experiences with actions distribution [188   5   4   4]
average reward/episode = -354.5
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  6   4   5 185]
average reward/episode = -351.5
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  0   1 196   3]
average reward/episode = -354.5
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  1   2 191   6]
average reward/episode = -291.7
Training on 6/204 success/total out of 491 1-step experiences with actions distribution [  6 195   2   1]
average reward/episode = -354.0
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  3   2   2 193]
average reward/episode = -141.8
Training on 10/206 success/total out of 316 1-step experiences with actions distribution [  1 200   2   3]
average reward/episode = -335.9
Training on 1/201 success/total out of 682 1-step experiences with actions distribution [194   2   4   1]
average reward/episode = -350.5
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [193   0   5   2]
average reward/episode = -355.5
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  0   1   4 195]
average reward/episode = -354.0
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  4   5 185   6]
average reward/episode = -325.0
Training on 2/202 success/total out of 526 1-step experiences with actions distribution [  1 193   4   4]
average reward/episode = -236.9
Training on 6/204 success/total out of 429 1-step experiences with actions distribution [  1 186   6  11]
average reward/episode = -354.5
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  0   1 194   5]
average reward/episode = -326.4
Training on 0/200 success/total out of 665 1-step experiences with actions distribution [  1   2   2 195]
average reward/episode = -354.0
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [196   0   2   2]
average reward/episode = -354.0
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [186   6   8]
average reward/episode = -417.8
Training on 1/201 success/total out of 633 1-step experiences with actions distribution [  3 195   3]
average reward/episode = -357.0
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  2   8 186   4]
average reward/episode = -322.9
Training on 1/201 success/total out of 659 1-step experiences with actions distribution [  1   3   2 195]
average reward/episode = -309.9
Training on 3/201 success/total out of 632 1-step experiences with actions distribution [  4   6   6 185]
average reward/episode = -219.4
Training on 4/204 success/total out of 401 1-step experiences with actions distribution [  2 195   2   5]
average reward/episode = -324.4
Training on 1/201 success/total out of 662 1-step experiences with actions distribution [  2   4 191   4]
average reward/episode = -353.0
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [194   2   2   2]
average reward/episode = -258.4
Training on 5/204 success/total out of 461 1-step experiences with actions distribution [  3 194   6   1]
average reward/episode = -354.5
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  3   2 195]
average reward/episode = -319.4
Training on 1/201 success/total out of 652 1-step experiences with actions distribution [194   4   2   1]
average reward/episode = -353.5
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  4   0   2 194]
average reward/episode = -252.7
Training on 6/204 success/total out of 450 1-step experiences with actions distribution [  3 193   3   5]
average reward/episode = -310.8
Training on 3/202 success/total out of 505 1-step experiences with actions distribution [  4 190   6   2]
average reward/episode = -352.0
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  2   2 196]
average reward/episode = -316.9
Training on 1/201 success/total out of 640 1-step experiences with actions distribution [  5   6 186   4]
average reward/episode = -351.5
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [189   0   4   7]
average reward/episode = -352.5
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  5   2   2 191]
average reward/episode = -356.5
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  4   4   3 189]
average reward/episode = -356.0
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [192   4   2   2]
average reward/episode = -302.7
Training on 2/202 success/total out of 492 1-step experiences with actions distribution [  2 198   1   1]
average reward/episode = -321.2
Training on 3/203 success/total out of 521 1-step experiences with actions distribution [  0 199   1   3]
average reward/episode = -353.0
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  2   0 198]
average reward/episode = -354.0
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  2   1 195   2]
average reward/episode = -295.2
Training on 3/202 success/total out of 622 1-step experiences with actions distribution [194   4   1   3]
average reward/episode = -355.5
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  0   3   5 192]
average reward/episode = -354.0
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  7   1   1 191]
average reward/episode = -225.1
Training on 7/205 success/total out of 410 1-step experiences with actions distribution [  0 201   2   2]
average reward/episode = -307.9
Training on 0/200 success/total out of 631 1-step experiences with actions distribution [191   2   3   4]
average reward/episode = -351.5
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [193   2   0   5]
average reward/episode = -352.5
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  2   2 193   3]
average reward/episode = -227.5
Training on 5/204 success/total out of 410 1-step experiences with actions distribution [  1 199   3   1]
average reward/episode = -360.3
Training on 2/202 success/total out of 561 1-step experiences with actions distribution [  5 193   2   2]
average reward/episode = -354.0
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  3   5   7 185]
average reward/episode = -353.0
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  0   1 198   1]
average reward/episode = -353.5
Training on 0/200 success/total out of 699 1-step experiences with actions distribution [  2   3 193   2]
average reward/episode = -324.9
Training on 1/201 success/total out of 657 1-step experiences with actions distribution [193   5   1   2]
average reward/episode = -311.9
Training on 1/201 success/total out of 633 1-step experiences with actions distribution [  1   1   4 195]
average reward/episode = -196.6
Training on 8/204 success/total out of 366 1-step experiences with actions distribution [  2 200   1   1]
